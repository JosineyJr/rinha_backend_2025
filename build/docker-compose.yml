services:
  api:
    build:
      context: ../ 
      dockerfile: ./build/Dockerfile # Point to the Dockerfile within the build folder
    container_name: rinha-api-dev
    networks:
      - backend
    environment:
      - PAYMENT_PROCESSOR_URL_DEFAULT=http://192.168.3.133:8001
      - PAYMENT_PROCESSOR_URL_FALLBACK=http://192.168.3.133:8002
    ports:
      - "9999:9999"
      - "2345:2345"
    volumes:
      - ../:/app
  influxdb:
      image: influxdb:2.7
      container_name: rinha-influxdb-dev
      ports:
        - "8086:8086"
      volumes:
        - ./influxdb/data:/var/lib/influxdb2
        - ./influxdb/init.sh:/docker-entrypoint-initdb.d/init.sh
      environment:
        - DOCKER_INFLUXDB_INIT_MODE=setup
        - DOCKER_INFLUXDB_INIT_USERNAME=myuser
        - DOCKER_INFLUXDB_INIT_PASSWORD=mysupersecretpassword
        - DOCKER_INFLUXDB_INIT_ORG=my-org
        - DOCKER_INFLUXDB_INIT_BUCKET=my-bucket
        - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=4qooWJYOHSDdqnzs9vW9Xoxn3QZbS6yd5inEwM4JC8RERi0J-Kn9ALYG5Ppi0vZMYHBf_necJIYFsKhNR2Ib9g==
      networks:
        - backend

networks:
  backend:
    driver: bridge